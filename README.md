# CodeCraft2025

2025华为软件精英挑战赛西北赛区复赛第9名-有的兄弟,有的-代码仓库及思路

# 前言
本次华为软件杯中，我们团队拿到了西北赛区第9名（二等奖）。该项目为区域赛复赛时使用的代码以及思路详解。

# 算法解析
**核心思路**：分页，按页读取，对象mask

## 全局预处理
全局预处理阶段会给出每个标签在所有时间内的写入、删除、读取的对象长度，以1800个时间片为单位。在这部分数据的处理上，我们根据每个标签在时间上的读取规律计算皮尔逊相似度，并根据相似度来规划存储在磁盘上的位置。

## 写入操作
在存储方面，我们对磁盘的空间进行了预先划分。对于每个磁盘，将其划分为n个页（默认数量为tag数*2），每个页将尽可能存放同一个标签的对象。

在准备写入对象时，会首先获取对象所属标签拥有的所有页，并将页按照剩余容量从小到大排序，即优先写入剩余容量小的页。写入时，遵循3份副本以及硬盘标号不同的原则，跳过不适合写入的页。

如果以上方法不足以写入三个副本，则会触发页申请机制，流程如下：
1. **选盘**：排除掉已经写入过副本的磁盘。对于每个磁盘，计算所需写入的对象标签与盘上所有页标签的相似度，优先选择相似度小的磁盘。同时，如果某个磁盘的剩余容量过小，则会降低优先级。
2. **选页**：完成选盘后，会继续从该磁盘上申请一个页。申请页时，会根据标签之间的相似度和页的剩余容量进行排序，优先将相似的页放在一起，同时优先选择剩余容量大的页。若有尚未被某个标签占据的页，则会在上述算法的基础上优先占据空白页，否则会占据某个已经写有其他标签数据的页，并修改占据该页的标签。

完成页申请后，会将数据写入该页中。重复该过程，直至完成3个副本的写入。

## 删除操作
删除操作较为简单，首先删除磁盘上的数据，之后查询未完成的请求并上报，然后取消数据所对应的读取请求。

## 读取操作
在读取部分，有两个较为重要的机制：按页读取和对象mask

### 1. 按页读取
指针在读取数据时，最好能够连续地进行读取，减少pass和jump操作的次数。为此，需要不时跳转到数据密度（分数密度）较大的位置，但频繁地跳转和简单的数据密度检测算法带来的效果较差。考虑到每个页中已尽可能存储某一个标签的数据，同时相同标签具有相似的读取特性，因此可以按页为磁头指派任务，并在完成某个页的任务时决定是否跳转。

当磁头完成了某个页的任务时（包括初始状态），磁盘会计算每个页上任务的价值，并按照价值进行排序。考虑到跳转会带来额外的开销，因此在计算磁头将要读取的下一个页的价值时，会额外乘一个补偿系数（代码中为1.2）。根据页的价值，为磁头指派一个价值最高的页，并根据磁头被指派的页进一步规划其行为。

当磁头不位于被指派的页中时，控制磁头跳转到页的起始位置。磁头在页中时，

《按照常规方法读取》

。

### 2. 对象mask
由于每个对象有3个副本，

## 垃圾回收

## 超时预测

# 后记

